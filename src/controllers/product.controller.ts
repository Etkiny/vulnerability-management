import { Response, Request } from 'express';
import { matchedData } from 'express-validator';
import { HttpStatusCode } from '../constants';
import ProductService from '../services/product.service';

const getUserProducts = async (req: Request, res: Response) => {
    const { userNumber } = matchedData(req, { locations: ['params'] });

    try {
        const result = await ProductService.getUserProducts(userNumber);
        return res.status(HttpStatusCode.OK).json({ data: result });
    } catch (error) {
        return res.status(HttpStatusCode.INTERNAL_SERVER_ERROR).json();
    }
};

const listAllProducts = async (req: Request, res: Response) => {
    try {
        const result = await ProductService.listAllProducts();
        return res.status(HttpStatusCode.OK).json({ data: result });
    } catch (error) {
        return res.status(HttpStatusCode.INTERNAL_SERVER_ERROR).json();
    }
};

const addUserProduct = async (req: Request, res: Response) => {
    const { userNumber, productNumber } = matchedData(req, { locations: ['body'] });

    try {
        const result = await ProductService.addUserProduct(userNumber, productNumber);
        return res.status(HttpStatusCode.OK).json({ data: result });
    } catch (error) {
        return res.status(HttpStatusCode.INTERNAL_SERVER_ERROR).json();
    }
};

// müşteriye ait ürünlerle ilgili müşteri son 30 gündeki zaafiyetleri görebilsin
const getUserProductVulnerabilities = async (req: Request, res: Response) => {
    const { productNumber } = matchedData(req, { locations: ['params'] });

    try {
        const result = await ProductService.getUserProductVulnerabilities(productNumber);
        return res.status(HttpStatusCode.OK).json({ data: result });
    } catch (error) {
        return res.status(HttpStatusCode.INTERNAL_SERVER_ERROR).json();
    }
};

export { getUserProducts, addUserProduct, listAllProducts, getUserProductVulnerabilities };
